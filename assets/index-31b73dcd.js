import I from"./relation-graph-logo-e4609733.js";import{n as s,i as P,b as D,I as u}from"./index-3a2b9e72.js";import"./svg-sprites-virtual-module-d0efe676.js";const T=e=>{const o={};return o.backgroundImage=e.backgroundImage,o.backgroundImageNoRepeat=e.backgrounImageNoRepeat,o.backgroundColor=e.backgroundColor,o.isMoveByParentNode=e.isMoveByParentNode,o.disableDragCanvas=e.disableDragCanvas,o.defaultNodeShape=e.defaultNodeShape,o.defaultNodeColor=e.defaultNodeColor,o.defaultNodeFontColor=e.defaultNodeFontColor,o.defaultNodeBorderColor=e.defaultNodeBorderColor,o.defaultNodeBorderWidth=e.defaultNodeBorderWidth,o.defaultNodeWidth=e.defaultNodeWidth,o.defaultNodeHeight=e.defaultNodeHeight,o.defaultExpandHolderPosition=e.defaultExpandHolderPosition,o.defaultLineColor=e.defaultLineColor,o.defaultLineFontColor=e.defaultLineFontColor,o.checkedLineColor=e.checkedLineColor,o.defaultLineWidth=e.defaultLineWidth,o.defaultLineShape=e.defaultLineShape,o.defaultJunctionPoint=e.defaultJunctionPoint,o.defaultLineTextOffset_x=e.defaultLineTextOffset_x,o.defaultLineTextOffset_y=e.defaultLineTextOffset_y,o.defaultLineMarker={markerWidth:e.defaultLineMarker.markerWidth,markerHeight:e.defaultLineMarker.markerHeight,refX:e.defaultLineMarker.refX,refY:e.defaultLineMarker.refY,data:e.defaultLineMarker.data},console.log("opt:",o),o},j=e=>e;let p=e=>{try{if(e.touches||e.targetTouches)return!0}catch{}return!1};const g=e=>{const o={clientX:0,clientY:0};if(p(e)){let t=e.touches||e.targetTouches;if(!t)throw console.log("event miss touches:",e),new Error("error targetTouches");t.length===0&&(t=e.changedTouches),o.clientX=t[0].clientX,o.clientY=t[0].clientY}else o.clientX=e.clientX,o.clientY=e.clientY;return o};var G=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"c-doc-toolbar"},[t("div",[t("div",{staticClass:"c-toolbar-item c-toolbar-logo"},[t("router-link",{attrs:{to:"/my-docs"}},[t("Logo",{attrs:{width:"30",height:"30"}})],1)],1),t("div",{staticClass:"c-toolbar-buttons"},[t("div",{staticClass:"c-mb-button",attrs:{title:"保存"},on:{click:e.saveGraph}},[e.savingToServer?t("svg",{staticClass:"c-loading-icon rg-icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"#icon-lianjiezhong"}})]):t("i",{staticClass:"el-icon-upload"})]),t("div",{staticClass:"c-toolbar-item c-doc-title"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.docName,expression:"docName"}],domProps:{value:e.docName},on:{blur:e.updateDocName,input:function(n){n.target.composing||(e.docName=n.target.value)}}})]),t("div",{staticClass:"c-toolbar-item c-toolbar-split"}),t("div",{staticClass:"c-mb-button",class:{"c-mb-button-on":e.graphState.showDefaultNodeOptionsPanel,"c-mb-button-ing":e.options.creatingNodePlot}},[t("div",{attrs:{title:"创建节点"},on:{click:function(n){return n.stopPropagation(),e.toggleNodeOptionsPanel.apply(null,arguments)},mousedown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&n.button!==0?null:(n.stopPropagation(),e.onNodeDragStart.apply(null,arguments))},touchstart:function(n){return n.stopPropagation(),e.onNodeDragStart.apply(null,arguments)}}},[t("svg-icon",{attrs:{"icon-class":"circle_plus"}})],1),t("div",{staticClass:"c-setting",staticStyle:{height:"70px",bottom:"-60px","padding-top":"10px"}},[t("div",{staticClass:"c-plug-icon",attrs:{title:"圆形节点"},on:{click:function(n){return e.startAddNode(n,0)}}},[t("svg-icon",{attrs:{"icon-class":"node-circle"}})],1),t("div",{staticClass:"c-plug-icon",attrs:{title:"正方形节点"},on:{click:function(n){return e.startAddNode(n,1)}}},[t("svg-icon",{attrs:{"icon-class":"node-rectangle"}})],1)])]),t("div",{staticClass:"c-mb-button",class:{"c-mb-button-on":e.graphState.showDefaultLineOptionsPanel,"c-mb-button-ing":e.options.creatingLinePlot},staticStyle:{"margin-left":"4px"}},[t("div",{attrs:{title:"创建连线"},on:{click:e.startAddLine}},[t("i",{staticClass:"el-icon-share"})]),t("div",{staticClass:"c-setting",staticStyle:{height:"160px",bottom:"-150px","padding-top":"10px"},attrs:{title:"正方形节点"}},[t("div",{staticClass:"c-plug-icon",attrs:{title:"直线"},on:{click:function(n){return e.startAddLine(n,1)}}},[t("svg-icon",{attrs:{"icon-class":"line-1"}})],1),t("div",{staticClass:"c-plug-icon",attrs:{title:"曲线1"},on:{click:function(n){return e.startAddLine(n,2)}}},[t("svg-icon",{attrs:{"icon-class":"line-2"}})],1),t("div",{staticClass:"c-plug-icon",attrs:{title:"曲线2"},on:{click:function(n){return e.startAddLine(n,3)}}},[t("svg-icon",{attrs:{"icon-class":"line-3"}})],1),t("div",{staticClass:"c-plug-icon",attrs:{title:"折线"},on:{click:function(n){return e.startAddLine(n,4)}}},[t("svg-icon",{attrs:{"icon-class":"line-4"}})],1),t("div",{staticClass:"c-plug-icon",attrs:{title:"曲线3"},on:{click:function(n){return e.startAddLine(n,5)}}},[t("svg-icon",{attrs:{"icon-class":"line-5"}})],1)])]),t("div",{staticClass:"c-toolbar-item c-toolbar-split"}),t("div",{staticClass:"c-mb-button",class:{"c-mb-button-on":e.graphState.showMoreActionPanel},attrs:{title:"更多操作"},on:{click:e.toggleMoreActionPanel}},[t("svg-icon",{attrs:{"icon-class":"circle_more"}})],1),t("div",{staticClass:"c-mb-button",class:{"c-mb-button-on":e.graphState.showDocInfoPanel},attrs:{title:"查看文档详情"},on:{click:e.toggleDocInfoPanel}},[t("i",{staticClass:"el-icon-files"})]),t("div",{staticStyle:{clear:"both"}})]),t("div",{staticStyle:{clear:"both"}})]),e.graphState.showDocInfoPanel?t("div",{staticClass:"c-more-action-panel"},[t("div",{staticStyle:{width:"330px","font-size":"12px",color:"#333333",padding:"10px","padding-bottom":"0px"}},[t("div",[t("span",{staticClass:"c-docinfo-key"},[e._v("创建时间：")]),e._v(e._s(e.$dayjs(e.doc.createTime||e.pageOpenTime).format("YYYY-MM-DD HH:mm:ss")))]),t("div",[t("span",{staticClass:"c-docinfo-key"},[e._v("最后修改时间：")]),e._v(e._s(e.$dayjs(e.doc.lastUpdateTime||e.pageOpenTime).format("YYYY-MM-DD HH:mm:ss")))]),t("div",[t("span",{staticClass:"c-docinfo-key"},[e._v("文档权限：")]),e._v(e._s(e.doc.privateDoc?"只有我能访问":"公开"))])]),t("div",{staticStyle:{"font-weight":"bold","line-height":"35px","font-size":"12px",color:"#333333"}},[e._v("文档操作历史：")]),t("div",{staticStyle:{height:"280px","overflow-y":"auto",border:"1px solid #efefef","font-size":"12px",color:"#333333",padding:"10px"}},e._l(e.doc.history,function(n){return t("div",{key:n.operateTime},[t("span",{staticClass:"c-doc-history-time"},[e._v(e._s(e.$dayjs(n.operateTime).format("YYYY-MM-DD HH:mm:ss")))]),e._v(" "),t("span",{staticClass:"c-doc-history-oper"},[e._v(e._s(n.userNickName))]),t("div",[e._v(" "+e._s(n.operateDesc)+" ")])])}),0)]):e._e(),e.graphState.showMoreActionPanel?t("div",{staticClass:"c-more-action-panel"},[t("button",{on:{click:e.downloadGraphData}},[e._v("下载图谱数据")]),t("button",{on:{click:e.downloadGraphSimplifyData}},[e._v("下载简洁数据")])]):e._e()])},M=[];const R={name:"GraphToolBar",components:{Logo:I},props:{remoteDocName:{mustUseProp:!0,default:"",type:String}},data(){return{pageOpenTime:Date.now(),showMoreNode:!1,savingToServer:!1,docName:"未命名文档",showNewNodeTemplate:!1,newObjectTemplatePosition:{x:0,y:0},newNodeIdIndex:1,newLineIdIndex:1}},inject:["graph","doc","graphState","graphInstance"],computed:{relationGraph(){return this.graphInstance()},options(){return this.graph.options}},watch:{remoteDocName(e){this.docName=e}},mounted(){},methods:{toggleDocInfoPanel(){this.graphState.showDocInfoPanel=!this.graphState.showDocInfoPanel,this.graphState.showMoreActionPanel=!1,this.graphState.showDefaultNodeOptionsPanel=!1,this.graphState.showDefaultLineOptionsPanel=!1},toggleMoreActionPanel(){this.graphState.showDocInfoPanel=!1,this.graphState.showMoreActionPanel=!this.graphState.showMoreActionPanel,this.graphState.showDefaultNodeOptionsPanel=!1,this.graphState.showDefaultLineOptionsPanel=!1},toggleNodeOptionsPanel(){this.graphState.showDocInfoPanel=!1,this.graphState.showMoreActionPanel=!1,this.graphState.showDefaultNodeOptionsPanel=!this.graphState.showDefaultNodeOptionsPanel,this.graphState.showDefaultLineOptionsPanel=!1},toggleLineOptionsPanel(){this.graphState.showDocInfoPanel=!1,this.graphState.showMoreActionPanel=!1,this.graphState.showDefaultNodeOptionsPanel=!1,this.graphState.showDefaultLineOptionsPanel=!this.graphState.showDefaultLineOptionsPanel},startAddNode(e,o=0){this.graphState.nodeTemplateUseSlot="",this.relationGraph.startCreatingNodePlot(e,{templateText:"Node",templateStyleClass:"rgnode-simple",templateNode:{nodeShape:o},onCreateNode:(t,n)=>{console.log("新增节点：",t,n);const a=this.relationGraph.generateNewNodeId();this.relationGraph.addNodes([{id:a,text:"新节点"+a,nodeShape:o,x:t,y:n}])}})},startAddLine(e,o=1){this.$message({type:"success",message:"点击任意节点开始创建线条！",duration:8e3}),this.relationGraph.startCreatingLinePlot(e,{template:{lineWidth:this.options.defaultLineWidth,color:this.options.defaultLineColor,lineShape:o,text:"新连线"},onCreateLine:(t,n)=>{if(console.log("新增连线：",t,n),n.id){const a=this.newLineIdIndex++;this.relationGraph.addLines([{from:t.id,to:n.id,lineShape:o,text:"新连线"+a}])}}})},async saveGraph(){if(this.savingToServer)return;this.savingToServer=!0,setTimeout(()=>{this.savingToServer=!1},15e3),await P(1e3);const e=this.relationGraph.getGraphJsonData(),o=await this.SeeksHttp.postJson("/my-graph/save-graph",{docId:this.doc.docId,name:this.docName,docContent:JSON.stringify({options:T(this.options),jsonData:j(e)})});this.savingToServer=!1;const t=o.data.data;if(console.log("saveResult:",t),!t.updated){this.$message({type:"info",message:t.message});return}const n=t.docId;this.doc.docId!==n?(this.doc.docId=n,this.doc.docName=t.name,this.doc.history=t.history.reverse(),this.doc.createTime=t.createTime,this.doc.lastUpdateTime=t.lastUpdateTime,this.$message({type:"success",message:"文档创建成功！"}),this.$router.push("/graph/"+n)):(this.doc.history=t.history.reverse(),this.doc.lastUpdateTime=t.lastUpdateTime,this.$message({type:"success",message:"保存成功！"}))},async updateDocName(){if(!this.docName){this.$message({type:"warning",message:"修改文档名称失败：文档名称不能为空！"}),this.docName=this.doc.docName;return}if(this.docName===this.doc.docName||!this.doc.docId)return;const o=(await this.SeeksHttp.postJson("/my-graph/update-doc-name",{docId:this.doc.docId,docName:this.docName})).data.data;console.log("saveResult:",o),this.doc.docName=this.docName,this.doc.history=this.history,this.doc.lastUpdateTime=this.lastUpdateTime,this.$message({type:"success",message:"文档名称已更新！"})},onNodeDragStart(e){console.log("onNodeDragStart:");let o=!1;const t=r=>{o=!0,p(r)?document.body.removeEventListener("touchend",t):document.body.removeEventListener("mouseup",t);const i=g(r),l=Math.abs(i.clientX-n.clientX)+Math.abs(i.clientY-n.clientY);if(a){l>40?console.log("up:over-width-more:then:cancel"):console.log("up:over-width-more");return}l>5?console.log("up:over-width-cancel"):(console.log("up:over-width-click"),this.startAddNode(r))},n=g(e);p(e)?document.body.addEventListener("touchend",t):document.body.addEventListener("mouseup",t);let a=!1;setTimeout(()=>{o||(console.log("show more:"),a=!0,this.showMoreNode=!0)},1e3),e.preventDefault()},downloadGraphData(){const e=this.relationGraph.getGraphJsonData();console.log(JSON.stringify(e))},downloadGraphSimplifyData(){const e=this.relationGraph.getGraphJsonData();e.nodes=this.relationGraph.getNodes().filter(o=>o.lot.level<4).map(o=>({id:o.id,text:o.text})),e.lines=e.lines.filter(o=>e.nodes.some(t=>t.id===o.from)&&e.nodes.some(t=>t.id===o.to)).map(o=>({text:o.text,from:o.from,to:o.to})),console.log(JSON.stringify(e))}}},m={};var z=s(R,G,M,!1,B,"daca98de",null,null);function B(e){for(let o in m)this[o]=m[o]}const W=function(){return z.exports}(),A=["","/images/graph-grid-bg.png","/images/grid-bg-1.png","/images/grid-bg-2.png","/images/grid-bg-3.png","/images/grid-bg-4.png","/images/grid-bg-5.png","/images/grid-bg-6.png","/images/grid-bg-7.png","/images/grid-bg-8.png","/images/grid-bg-9.png"],H=["","#ffffff","#888888","#000000","rgb(101, 163, 13)","rgb(236, 72, 153)","rgb(234, 179, 8)","rgb(134, 239, 172)","rgb(59, 130, 246)","rgb(147, 51, 234)","rgb(216, 180, 254)","rgb(129, 140, 248)","rgb(254, 249, 195)","rgb(253, 224, 71)","rgb(249, 168, 212)"],c=["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],d=["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgb(255, 120, 0)","hsl(181, 100%, 37%)","#c7158577"],E=[{text:"锋利",markerWidth:12,markerHeight:12,refX:6,refY:6,color:void 0,data:"M2,2 L10,6 L2,10 L6,6 L2,2"},{text:"不锋利",markerWidth:20,markerHeight:20,refX:3,refY:3,color:void 0,data:"M 0 0, V 6, L 4 3, Z"},{text:"样式3",markerWidth:15,markerHeight:15,refX:30,refY:7,color:"#128bed",data:"M 14 7 L 1 .3 L 4 7 L .4 13 L 14 7, Z"}];var F=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"c-options-panel"},[t("div",[t("el-form",{attrs:{"label-width":"130px",size:"mini"}},[t("el-divider",{attrs:{"content-position":"left"}},[e._v("【全局】节点 默认样式")]),t("el-form-item",{attrs:{label:"默认的节点形状"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultNodeShape,callback:function(n){e.$set(e.options,"defaultNodeShape",n)},expression:"options.defaultNodeShape"}},[t("el-radio-button",{attrs:{label:0}},[e._v("圆形")]),t("el-radio-button",{attrs:{label:1}},[e._v("矩形")])],1)],1),t("el-form-item",{attrs:{label:"默认节点颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",predefine:e.predefineColors},on:{change:e.resetGraphOptions},model:{value:e.options.defaultNodeColor,callback:function(n){e.$set(e.options,"defaultNodeColor",n)},expression:"options.defaultNodeColor"}})],1),t("el-form-item",{attrs:{label:"默认节点文字颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",size:"mini",predefine:e.predefineColors},on:{change:e.resetGraphOptions},model:{value:e.options.defaultNodeFontColor,callback:function(n){e.$set(e.options,"defaultNodeFontColor",n)},expression:"options.defaultNodeFontColor"}})],1),t("el-form-item",{attrs:{label:"默认节点边框颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",size:"mini",predefine:e.predefineColors},on:{change:e.resetGraphOptions},model:{value:e.options.defaultNodeBorderColor,callback:function(n){e.$set(e.options,"defaultNodeBorderColor",n)},expression:"options.defaultNodeBorderColor"}})],1),t("el-form-item",{attrs:{label:"默认的节点边框粗细"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultNodeBorderWidth,callback:function(n){e.$set(e.options,"defaultNodeBorderWidth",n)},expression:"options.defaultNodeBorderWidth"}},[t("el-radio-button",{attrs:{label:0}},[e._v("0")]),t("el-radio-button",{attrs:{label:1}},[e._v("1")]),t("el-radio-button",{attrs:{label:2}},[e._v("2")]),t("el-radio-button",{attrs:{label:3}},[e._v("3")]),t("el-radio-button",{attrs:{label:4}},[e._v("4")]),t("el-radio-button",{attrs:{label:5}},[e._v("5")])],1)],1),t("el-form-item",{attrs:{label:"默认的节点大小"}},[e._v(" 宽度："),t("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultNodeWidth,callback:function(n){e.$set(e.options,"defaultNodeWidth",n)},expression:"options.defaultNodeWidth"}}),e._v(" 高度："),t("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultNodeHeight,callback:function(n){e.$set(e.options,"defaultNodeHeight",n)},expression:"options.defaultNodeHeight"}})],1),t("el-form-item",{attrs:{label:"节点展开/关闭按钮位置"}},[t("el-radio-group",{on:{change:e.resetGraphOptions},model:{value:e.options.defaultExpandHolderPosition,callback:function(n){e.$set(e.options,"defaultExpandHolderPosition",n)},expression:"options.defaultExpandHolderPosition"}},[t("el-radio-button",{attrs:{label:"top"}},[e._v("上")]),t("el-radio-button",{attrs:{label:"bottom"}},[e._v("下")]),t("el-radio-button",{attrs:{label:"left"}},[e._v("左")]),t("el-radio-button",{attrs:{label:"right"}},[e._v("右")]),t("el-radio-button",{attrs:{label:"hide"}},[e._v("隐藏")])],1)],1)],1)],1)])},Y=[];const U={name:"DefaultNodeOptions",data(){return{predefineColors:c,predefineColorsBorder:d,defaultNodeColor:"rgba(255, 69, 0, 0.68)"}},inject:["graph","currentObject","graphInstance"],computed:{relationGraph(){return this.graphInstance()},options(){return this.graph.options}},mounted(){},methods:{resetGraphOptions(){}}},_={};var J=s(U,F,Y,!1,X,"2ea502e6",null,null);function X(e){for(let o in _)this[o]=_[o]}const O=function(){return J.exports}();var q=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"c-options-panel"},[t("div",{staticStyle:{"padding-bottom":"10px"}},[e._v("连线的默认样式：")]),t("div",[t("el-form",{attrs:{"label-width":"130px",size:"mini"}},[t("el-divider",{attrs:{"content-position":"left"}},[e._v("【全局】连线 默认样式")]),t("el-form-item",{attrs:{label:"默认线条颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",size:"mini",predefine:e.predefineColors},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineColor,callback:function(n){e.$set(e.options,"defaultLineColor",n)},expression:"options.defaultLineColor"}})],1),t("el-form-item",{attrs:{label:"默认线条文字颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",size:"mini",predefine:e.predefineColors},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineFontColor,callback:function(n){e.$set(e.options,"defaultLineFontColor",n)},expression:"options.defaultLineFontColor"}})],1),t("el-form-item",{attrs:{label:"连接文字x偏移量"}},[t("el-slider",{attrs:{min:-50,max:50,"show-tooltip":!0},model:{value:e.options.defaultLineTextOffset_x,callback:function(n){e.$set(e.options,"defaultLineTextOffset_x",n)},expression:"options.defaultLineTextOffset_x"}})],1),t("el-form-item",{attrs:{label:"连接文字y偏移量"}},[t("el-slider",{attrs:{min:-50,max:50,"show-tooltip":!0},model:{value:e.options.defaultLineTextOffset_y,callback:function(n){e.$set(e.options,"defaultLineTextOffset_y",n)},expression:"options.defaultLineTextOffset_y"}})],1),t("el-form-item",{attrs:{label:"默认的连线粗细"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineWidth,callback:function(n){e.$set(e.options,"defaultLineWidth",n)},expression:"options.defaultLineWidth"}},[t("el-radio-button",{attrs:{label:1}},[e._v("1")]),t("el-radio-button",{attrs:{label:2}},[e._v("2")]),t("el-radio-button",{attrs:{label:3}},[e._v("3")]),t("el-radio-button",{attrs:{label:5}},[e._v("5")]),t("el-radio-button",{attrs:{label:8}},[e._v("8")]),t("el-radio-button",{attrs:{label:12}},[e._v("12")])],1)],1),t("el-form-item",{attrs:{label:"默认的线条形状"}},[t("el-radio-group",{on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineShape,callback:function(n){e.$set(e.options,"defaultLineShape",n)},expression:"options.defaultLineShape"}},[t("el-radio-button",{attrs:{label:1}},[e._v("直线")]),t("el-radio-button",{attrs:{label:2}},[e._v("简洁")]),t("el-radio-button",{attrs:{label:3}},[e._v("生动")]),t("el-radio-button",{attrs:{label:5}},[e._v("鱼尾")]),t("el-radio-button",{attrs:{label:6}},[e._v("6")]),t("el-radio-button",{attrs:{label:7}},[e._v("7")]),t("el-radio-button",{attrs:{label:4}},[e._v("折线")])],1)],1),t("el-form-item",{attrs:{label:"默认的线条连接点"}},[t("el-radio-group",{on:{change:e.resetGraphOptions},model:{value:e.options.defaultJunctionPoint,callback:function(n){e.$set(e.options,"defaultJunctionPoint",n)},expression:"options.defaultJunctionPoint"}},[t("el-radio-button",{attrs:{label:"border"}},[e._v("边缘")]),t("el-radio-button",{attrs:{label:"tb"}},[e._v("上下")]),t("el-radio-button",{attrs:{label:"lr"}},[e._v("左右")]),t("el-radio-button",{attrs:{label:"ltrb"}},[e._v("上下左右")])],1)],1),t("el-form-item",{attrs:{label:"默认的连线箭头"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.changeDefaultArrow},model:{value:e.currentArrowData,callback:function(n){e.currentArrowData=n},expression:"currentArrowData"}},e._l(e.definedArrow,function(n){return t("el-radio-button",{key:n.text,attrs:{label:n.data}},[e._v(e._s(n.text))])}),1)],1),t("el-form-item",{attrs:{label:"连线箭头样式"}},[e._v(" 箭头宽度："),t("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineMarker.markerWidth,callback:function(n){e.$set(e.options.defaultLineMarker,"markerWidth",n)},expression:"options.defaultLineMarker.markerWidth"}}),e._v(" X偏移："),t("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineMarker.refX,callback:function(n){e.$set(e.options.defaultLineMarker,"refX",n)},expression:"options.defaultLineMarker.refX"}}),t("div",{staticStyle:{height:"1px"}}),e._v(" 箭头高度："),t("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineMarker.markerHeight,callback:function(n){e.$set(e.options.defaultLineMarker,"markerHeight",n)},expression:"options.defaultLineMarker.markerHeight"}}),e._v(" Y偏移："),t("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineMarker.refY,callback:function(n){e.$set(e.options.defaultLineMarker,"refY",n)},expression:"options.defaultLineMarker.refY"}}),t("div",{staticStyle:{height:"1px"}}),e._v(" 箭头形状："),t("el-input",{staticStyle:{width:"160px"},attrs:{size:"mini"},on:{change:e.resetGraphOptions},model:{value:e.options.defaultLineMarker.data,callback:function(n){e.$set(e.options.defaultLineMarker,"data",n)},expression:"options.defaultLineMarker.data"}})],1)],1)],1)])},K=[];const Z={name:"DefaultLineOptions",data(){return{predefineColors:c,predefineColorsBorder:d,currentArrowData:null,definedArrow:E}},inject:["graph","currentObject","graphInstance"],computed:{relationGraph(){return this.graphInstance()},options(){return this.graph.options}},mounted(){},methods:{changeDefaultArrow(){this.definedArrow.forEach(e=>{e.data===this.currentArrowData&&(this.options.defaultLineMarker.markerWidth=e.markerWidth,this.options.defaultLineMarker.markerHeight=e.markerHeight,this.options.defaultLineMarker.refX=e.refX,this.options.defaultLineMarker.refY=e.refY,this.options.defaultLineMarker.data=e.data)}),this.resetGraphOptions()},resetGraphOptions(){}}},v={};var Q=s(Z,q,K,!1,V,"0ec5d090",null,null);function V(e){for(let o in v)this[o]=v[o]}const S=function(){return Q.exports}();var ee=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[e._v(" 显示网格： "),t("div",{staticClass:"c-items-box"},e._l(e.gridBackground,function(n,a){return t("div",{key:n,staticClass:"c-color-item c-grid-bg-item",style:{"background-image":"url("+n+")"},on:{click:function(r){return e.setGridtBackground(n)}}},[n===""?t("svg-icon",{attrs:{"icon-class":"no_waiting_sign"}}):e._e()],1)}),0),e._v(" 背景颜色： "),t("div",{staticClass:"c-items-box"},e._l(e.backgroundColors,function(n,a){return t("div",{key:n,staticClass:"c-color-item",style:{"background-color":n},on:{click:function(r){return e.setBackgroundColor(n)}}},[n===""?t("svg-icon",{attrs:{"icon-class":"no_waiting_sign"}}):e._e()],1)}),0),t("el-form",{attrs:{"label-width":"170px",size:"mini"}},[t("el-form-item",{attrs:{label:"子节点跟随父节点移动："}},[t("el-switch",{model:{value:e.options.isMoveByParentNode,callback:function(n){e.$set(e.options,"isMoveByParentNode",n)},expression:"options.isMoveByParentNode"}})],1),t("el-form-item",{attrs:{label:"鼠标右键拖住框选："}},[t("el-switch",{model:{value:e.options.disableDragCanvas,callback:function(n){e.$set(e.options,"disableDragCanvas",n)},expression:"options.disableDragCanvas"}})],1)],1),t("div",{staticClass:"c-more-action-panel"},[t("DefaultNodeOptions")],1),t("div",{staticClass:"c-more-action-panel"},[t("DefaultLineOptions")],1)],1)},te=[];const ne={name:"CanvasOptions",components:{DefaultNodeOptions:O,DefaultLineOptions:S},data(){return{showNewNodeTemplate:!1,newObjectTemplatePosition:{x:0,y:0},newNodeIdIndex:1,newLineIdIndex:1,gridBackground:A,backgroundColors:H}},inject:["graph","currentObject","graphInstance"],computed:{relationGraph(){return this.graphInstance()},options(){return this.graph.options},currentObjectType(){return this.currentObject.type},currentNode(){return this.currentObject.node},currentLink(){return this.currentObject.link},currentLine(){return this.currentObject.line}},mounted(){},methods:{setGridtBackground(e){this.options.backgroundImage=e,this.options.backgroundImageNoRepeat=!1},setBackgroundColor(e){this.options.backgroundColor=e}}},b={};var oe=s(ne,ee,te,!1,ae,"8baa5970",null,null);function ae(e){for(let o in b)this[o]=b[o]}const re=function(){return oe.exports}();var ie=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[e.currentLine?t("div",[t("el-form",{attrs:{"label-width":"120px",size:"mini"}},[t("el-divider",{attrs:{"content-position":"left"}},[e._v("连线信息")]),t("el-form-item",{attrs:{label:"线条形状"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.lineShape,callback:function(n){e.$set(e.currentLine,"lineShape",n)},expression:"currentLine.lineShape"}},[t("el-radio-button",{attrs:{label:1}},[e._v("直线")]),t("el-radio-button",{attrs:{label:2}},[e._v("简洁")]),t("el-radio-button",{attrs:{label:3}},[e._v("生动")]),t("el-radio-button",{attrs:{label:5}},[e._v("鱼尾")]),t("el-radio-button",{attrs:{label:4}},[e._v("折线")])],1)],1),t("el-form-item",{attrs:{label:"虚线"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.dashType,callback:function(n){e.$set(e.currentLine,"dashType",n)},expression:"currentLine.dashType"}},[t("el-radio-button",{attrs:{label:0}},[e._v("无")]),t("el-radio-button",{attrs:{label:1}},[e._v("虚线1")]),t("el-radio-button",{attrs:{label:2}},[e._v("虚线2")]),t("el-radio-button",{attrs:{label:3}},[e._v("虚线3")]),t("el-radio-button",{attrs:{label:4}},[e._v("虚线4")])],1)],1),t("el-form-item",{attrs:{label:"动效"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.animation,callback:function(n){e.$set(e.currentLine,"animation",n)},expression:"currentLine.animation"}},[t("el-radio-button",{attrs:{label:0}},[e._v("无")]),t("el-radio-button",{attrs:{label:1}},[e._v("动效1")]),t("el-radio-button",{attrs:{label:2}},[e._v("动效2")]),t("el-radio-button",{attrs:{label:3}},[e._v("动效3")]),t("el-radio-button",{attrs:{label:4}},[e._v("动效4")])],1)],1),t("el-form-item",{attrs:{label:"自定义样式名(class)"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini"},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.styleClass,callback:function(n){e.$set(e.currentLine,"styleClass",n)},expression:"currentLine.styleClass"}})],1),t("el-form-item",{attrs:{label:"连线文字"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini"},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.text,callback:function(n){e.$set(e.currentLine,"text",n)},expression:"currentLine.text"}})],1),t("el-form-item",{attrs:{label:"线条粗细"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.lineWidth,callback:function(n){e.$set(e.currentLine,"lineWidth",n)},expression:"currentLine.lineWidth"}},[t("el-radio-button",{attrs:{label:1}},[e._v("1")]),t("el-radio-button",{attrs:{label:2}},[e._v("2")]),t("el-radio-button",{attrs:{label:3}},[e._v("3")]),t("el-radio-button",{attrs:{label:4}},[e._v("4")]),t("el-radio-button",{attrs:{label:5}},[e._v("5")])],1)],1),t("el-form-item",{attrs:{label:"透明度"}},[t("el-slider",{attrs:{step:.1,min:0,max:1},model:{value:e.currentLine.opacity,callback:function(n){e.$set(e.currentLine,"opacity",n)},expression:"currentLine.opacity"}})],1),t("el-form-item",{attrs:{label:"线条颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",size:"mini",predefine:e.predefineColors},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.color,callback:function(n){e.$set(e.currentLine,"color",n)},expression:"currentLine.color"}})],1),t("el-form-item",{attrs:{label:"文字颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",size:"mini",predefine:e.predefineColors},on:{change:e.onlineOptionChanged},model:{value:e.currentLine.fontColor,callback:function(n){e.$set(e.currentLine,"fontColor",n)},expression:"currentLine.fontColor"}})],1),t("el-form-item",{attrs:{label:"文字沿着线条路径走"}},[t("el-switch",{on:{change:e.onlineOptionChanged},model:{value:e.currentLine.useTextPath,callback:function(n){e.$set(e.currentLine,"useTextPath",n)},expression:"currentLine.useTextPath"}})],1),e.currentLine.isHideArrow?e._e():t("el-form-item",{attrs:{label:"显示起始箭头"}},[t("el-switch",{on:{change:e.onlineOptionChanged},model:{value:e.currentLine.showStartArrow,callback:function(n){e.$set(e.currentLine,"showStartArrow",n)},expression:"currentLine.showStartArrow"}})],1),e.currentLine.isHideArrow?e._e():t("el-form-item",{attrs:{label:"显示终止箭头"}},[t("el-switch",{on:{change:e.onlineOptionChanged},model:{value:e.currentLine.showEndArrow,callback:function(n){e.$set(e.currentLine,"showEndArrow",n)},expression:"currentLine.showEndArrow"}})],1)],1)],1):e._e()])},se=[];const le={name:"LineOptions",components:{},props:{onLineChange:{mustUseProp:!1,default:()=>()=>{},type:Function}},data(){return{currentLine:null,predefineColors:c,predefineColorsBorder:d}},created(){},mounted(){},methods:{setLine(e){console.log("currentLine:",e),this.currentLine=e},onlineOptionChanged(){console.log("new line json:",this.currentLine),this.onLineChange()}}},x={};var ce=s(le,ie,se,!1,de,"2f036939",null,null);function de(e){for(let o in x)this[o]=x[o]}const ue=function(){return ce.exports}();var pe=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[e.currentLink?t("div",[t("div",{staticClass:"c-node-menu-item",on:{click:e.deleteLink}},[e._v("删除关系")]),t("div",{staticStyle:{padding:"20px","font-size":"12px",color:"#666666"}},[e._v(" 关系【"+e._s(e.currentLink.fromNode.text)+"】 与【"+e._s(e.currentLink.toNode.text)+"】之间的所有的线条： ")]),t("el-radio-group",{attrs:{size:"mini"},on:{change:e.switchCurrentLine},model:{value:e.currentLineIndex,callback:function(n){e.currentLineIndex=n},expression:"currentLineIndex"}},e._l(e.currentLines,function(n,a){return t("el-radio-button",{key:n.seeks_id,attrs:{label:a}},[e._v("Line"+e._s(a))])}),1),t("div",{staticClass:"c-node-menu-item",on:{click:e.deleteLine}},[e._v("删除连线")]),t("div",{staticClass:"c-node-menu-item",on:{click:e.reverseLine}},[e._v("翻转连线方向")]),t("LineOptions",{ref:"lineRef"})],1):e._e()])},he=[];const fe={name:"LinkOptions",components:{LineOptions:ue},props:{onLineChange:{mustUseProp:!1,default:()=>()=>{},type:Function}},data(){return{currentLink:null,currentLineIndex:0,predefineColors:c,predefineColorsBorder:d}},inject:["graph","graphInstance"],computed:{currentLines(){return this.currentLink.relations},currentLine(){return this.currentLines[this.currentLineIndex]},relationGraph(){return this.graphInstance()},options(){return this.graph.options}},created(){},mounted(){},methods:{setLink(e,o){console.log("currentLines:",o,e),this.currentLink=e,this.currentLineIndex=this.currentLines.indexOf(o),this.switchCurrentLine()},switchCurrentLine(){this.currentLineIndex===-1&&(this.currentLineIndex=0),this.$nextTick(()=>{this.$refs.lineRef.setLine(this.currentLine)})},onlineOptionChanged(){this.onLineChange()},reverseLine(e){this.relationGraph.reverseLine(this.currentLink,this.currentLine)},deleteLine(e){this.relationGraph.removeLine(this.currentLink,this.currentLine)},deleteLink(e){this.relationGraph.removeLink(this.currentLink)}}},N={};var ge=s(fe,pe,he,!1,me,"48534012",null,null);function me(e){for(let o in N)this[o]=N[o]}const _e=function(){return ge.exports}();var ve=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[e.currentNode?t("div",[t("el-form",{attrs:{"label-width":"120px",size:"mini"}},[t("el-divider",{attrs:{"content-position":"left"}},[e._v("节点信息")]),t("el-form-item",{attrs:{label:"自定义样式名(class)"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.styleClass,callback:function(n){e.$set(e.currentNode,"styleClass",n)},expression:"currentNode.styleClass"}})],1),t("el-form-item",{attrs:{label:"节点文字"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.text,callback:function(n){e.$set(e.currentNode,"text",n)},expression:"currentNode.text"}})],1),t("el-form-item",{attrs:{label:"节点颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",predefine:e.predefineColors},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.color,callback:function(n){e.$set(e.currentNode,"color",n)},expression:"currentNode.color"}})],1),t("el-form-item",{attrs:{label:"文字颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",predefine:e.predefineColors},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.fontColor,callback:function(n){e.$set(e.currentNode,"fontColor",n)},expression:"currentNode.fontColor"}})],1),t("el-form-item",{attrs:{label:"边框粗细"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.borderWidth,callback:function(n){e.$set(e.currentNode,"borderWidth",n)},expression:"currentNode.borderWidth"}},[t("el-radio-button",{attrs:{label:0}},[e._v("0")]),t("el-radio-button",{attrs:{label:1}},[e._v("1")]),t("el-radio-button",{attrs:{label:2}},[e._v("2")]),t("el-radio-button",{attrs:{label:3}},[e._v("3")]),t("el-radio-button",{attrs:{label:4}},[e._v("4")]),t("el-radio-button",{attrs:{label:5}},[e._v("5")])],1)],1),t("el-form-item",{attrs:{label:"边框颜色"}},[t("el-color-picker",{attrs:{"show-alpha":"",predefine:e.predefineColors},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.borderColor,callback:function(n){e.$set(e.currentNode,"borderColor",n)},expression:"currentNode.borderColor"}})],1),t("el-form-item",{attrs:{label:"节点形状"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.nodeShape,callback:function(n){e.$set(e.currentNode,"nodeShape",n)},expression:"currentNode.nodeShape"}},[t("el-radio-button",{attrs:{label:0}},[e._v("圆形")]),t("el-radio-button",{attrs:{label:1}},[e._v("矩形")])],1)],1),t("el-form-item",{attrs:{label:"节点大小"}},[e._v(" 宽度："),t("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.width,callback:function(n){e.$set(e.currentNode,"width",n)},expression:"currentNode.width"}}),e._v(" 高度："),t("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.height,callback:function(n){e.$set(e.currentNode,"height",n)},expression:"currentNode.height"}})],1),t("el-form-item",{attrs:{label:"透明度"}},[t("el-slider",{attrs:{max:1,min:0,step:.1},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.opacity,callback:function(n){e.$set(e.currentNode,"opacity",n)},expression:"currentNode.opacity"}})],1),t("el-form-item",{attrs:{label:"展开/关闭按钮位置"}},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.expandHolderPosition,callback:function(n){e.$set(e.currentNode,"expandHolderPosition",n)},expression:"currentNode.expandHolderPosition"}},[t("el-radio-button",{attrs:{label:"top"}},[e._v("上")]),t("el-radio-button",{attrs:{label:"bottom"}},[e._v("下")]),t("el-radio-button",{attrs:{label:"left"}},[e._v("左")]),t("el-radio-button",{attrs:{label:"right"}},[e._v("右")]),t("el-radio-button",{attrs:{label:"hide"}},[e._v("隐藏")])],1)],1),e.currentNode.expandHolderPosition&&e.currentNode.expandHolderPosition!=="hide"?t("el-form-item",{attrs:{label:"默认是未展开的样式"}},[t("el-switch",{attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.expanded,callback:function(n){e.$set(e.currentNode,"expanded",n)},expression:"currentNode.expanded"}})],1):e._e(),e.currentNode.fixed?t("el-form-item",{attrs:{label:"固定坐标"}},[e._v(" x："),t("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.x,callback:function(n){e.$set(e.currentNode,"x",n)},expression:"currentNode.x"}}),e._v(" y："),t("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{change:e.onNodeOptionChanged},model:{value:e.currentNode.y,callback:function(n){e.$set(e.currentNode,"y",n)},expression:"currentNode.y"}})],1):e._e()],1)],1):e._e()])},be=[];const xe={name:"NodeOptions",components:{},props:{onNodeChange:{mustUseProp:!1,default:()=>()=>{},type:Function}},data(){return{currentNode:null,predefineColors:c,predefineColorsBorder:d}},computed:D({}),created(){},mounted(){},methods:{setNode(e){this.currentNode=e},onNodeOptionChanged(){this.onNodeChange()}}},k={};var Ne=s(xe,ve,be,!1,ke,"359b3fa0",null,null);function ke(e){for(let o in k)this[o]=k[o]}const ye=function(){return Ne.exports}();var Le=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"c-toolbar"},[e.selectedNodes.length===0?t("div",[t("div",{staticClass:"c-object-info"},[t("div",[e._v("当前对象类型："+e._s(e.currentObjectType))]),e.currentObjectType==="line"?t("div",[e._v(e._s(e.currentLink.fromNode.text)+" -> "+e._s(e.currentLink.toNode.text))]):e._e(),e.currentObjectType==="node"?t("div",[e._v("ID:"+e._s(e.currentNode.id))]):e._e(),e.currentObjectType==="node"?t("div",[e._v("Text:"+e._s(e.currentNode.text))]):e._e()]),e.currentObjectType==="canvas"?t("div",[t("CanvasOptions")],1):e._e(),e.currentObjectType==="node"?t("div",[t("div",{staticClass:"c-node-menu-item",on:{click:e.deleteNode}},[e._v("删除节点")]),t("div",[e._v("以此节点为中心布局：")]),t("div",{staticClass:"c-node-menu-item",on:{click:e.startForceLayout}},[e.options.autoLayouting?t("svg",{staticClass:"c-loading-icon rg-icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"#icon-lianjiezhong"}})]):t("svg",{staticClass:"rg-icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"#icon-zidong"}})]),e._v(" 力学布局 ")]),t("div",{staticClass:"c-node-menu-item",on:{click:e.startTreeLayout}},[e._v("树状布局")]),t("div",{staticClass:"c-node-menu-item",on:{click:e.startCircleLayout}},[e._v("环形布局")]),t("NodeOptions",{ref:"nodeOptionsRef"})],1):e._e(),e.currentObjectType==="line"||e.currentObjectType==="link"?t("div",[t("LinkOptions",{ref:"linkOptionsRef"})],1):e._e()]):t("div",[t("div",[e._v("当前选择节点个数："+e._s(e.selectedNodes.length)+" ")]),t("div",[e._v("以此节点为中心布局：")]),t("div",{staticClass:"c-node-menu-item",on:{click:function(n){return e.startForceLayout(n,e.selectedNodes)}}},[e.options.autoLayouting?t("svg",{staticClass:"c-loading-icon rg-icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"#icon-lianjiezhong"}})]):t("svg",{staticClass:"rg-icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"#icon-zidong"}})]),e._v(" 力学布局 ")]),t("div",{staticClass:"c-node-menu-item",on:{click:function(n){return e.startCircleLayout(n,e.selectedNodes)}}},[e._v("环形布局")]),t("div",{staticClass:"c-node-menu-item",on:{click:function(n){return e.startTreeLayout(n,e.selectedNodes)}}},[e._v("树状布局")])])])},Ce=[];const we={name:"ItemOptions",components:{NodeOptions:ye,LinkOptions:_e,CanvasOptions:re,DefaultNodeOptions:O,DefaultLineOptions:S},data(){return{showNewNodeTemplate:!1,newObjectTemplatePosition:{x:0,y:0},newNodeIdIndex:1,newLineIdIndex:1}},inject:["graph","currentObject","graphInstance"],computed:{relationGraph(){return this.graphInstance()},options(){return this.graph.options},currentObjectType(){return this.currentObject.type},selectedNodes(){return this.currentObject.selectedNodes},currentNode(){return this.currentObject.node},currentLink(){return this.currentObject.link},currentLine(){return this.currentObject.line}},watch:{currentNode(){this.$nextTick(()=>{this.currentNode&&this.$refs.nodeOptionsRef&&this.$refs.nodeOptionsRef.setNode(this.currentNode)})},currentLink(){this.$nextTick(()=>{this.currentLink&&this.$refs.linkOptionsRef.setLink(this.currentLink,this.currentLine)})},currentLine(){this.$nextTick(()=>{this.currentLink&&this.$refs.linkOptionsRef.setLink(this.currentLink,this.currentLine)})}},mounted(){this.options.layouts.length>1&&(this.height-=40)},methods:{deleteNode(e){this.relationGraph.removeNode(this.currentNode)},startForceLayout(e,o){console.log("startForceLayout:",this.currentNode);const t=o||this.relationGraph.getGroupByNode(this.currentNode),n=o?o[0]:this.currentNode;new u.ForceLayouter({fixedRootNode:!0},this.options).placeNodes(t,n)},startCircleLayout(e,o){const t=o||this.relationGraph.getGroupByNode(this.currentNode),n=o?o[0]:this.currentNode,a={fixedRootNode:!0};new u.CircleLayouter(a,this.options).placeNodes(t,n)},startTreeLayout(e,o){const t=o||this.relationGraph.graphData.nodes,n=o?o[0]:this.currentNode,a={fixedRootNode:!0};console.log("layoutOptions:",a),new u.BidirectionalTreeLayouter(a,this.options).placeNodes(t,n)},startCenterLayout(e,o){const t=o||this.relationGraph.graphData.nodes,n=o?o[0]:this.currentNode,a={fixedRootNode:!0};new u.CenterLayouter(a,this.options).placeNodes(t,n)},setGridtBackground(e){this.options.backgrounImage=e,this.options.backgrounImageNoRepeat=!1},setBackgroundColor(e){this.options.backgroundColor=e}}},y={};var Oe=s(we,Le,Ce,!1,Se,"4137b2c0",null,null);function Se(e){for(let o in y)this[o]=y[o]}const $e=function(){return Oe.exports}();var Ie=function(){var e=this,o=e.$createElement,t=e._self._c||o;return e.icon?t("div",[t("svg-icon",{attrs:{"icon-class":"user"}})],1):t("div",{staticStyle:{"border-radius":"5px",width:"180px",display:"flex","flex-flow":"row","align-items":"flex-start","padding-top":"5px"}},[t("div",{staticStyle:{"text-align":"center","flex-grow":"0",width:"30px"}},[t("svg-icon",{staticStyle:{height:"15px"},attrs:{"icon-class":"user"}})],1),t("div",{staticStyle:{"font-size":"12px",width:"70px","text-align":"left"}},[e._v(e._s(e.node.text))]),t("div",{staticStyle:{width:"40px","padding-right":"10px","text-align":"left"}},[t("el-switch",{attrs:{size:"mini"},model:{value:e.node.data.checkin,callback:function(n){e.$set(e.node.data,"checkin",n)},expression:"node.data.checkin"}})],1)])},Pe=[];const De={props:{icon:{type:Boolean,required:!1},node:{type:Object,required:!1}},mounted(){}},L={};var Te=s(De,Ie,Pe,!1,je,"2d7b69c4",null,null);function je(e){for(let o in L)this[o]=L[o]}const $=function(){return Te.exports}();var Ge=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"c-object-templates-panel"},[t("div",{staticClass:"c-dragable-item-box"},[t("div",{staticClass:"c-dragable-item",on:{mousedown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&n.button!==0?null:e.onDragStart(n,"rgnode-simple",{nodeShape:0,width:60,height:60})},touchstart:function(n){return e.onDragStart(n,"rgnode-simple",{nodeShape:0,width:60,height:60})}}},[t("i",{staticClass:"el-icon-warning"})]),t("div",{staticClass:"c-dragable-item",on:{mousedown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&n.button!==0?null:e.onDragStart(n,"rgnode-rect",{nodeShape:1,width:60,height:60})},touchstart:function(n){return e.onDragStart(n,"rgnode-rect",{nodeShape:1,width:60,height:60})}}},[t("i",{staticClass:"el-icon-picture"})]),t("div",{staticClass:"c-dragable-item",on:{mousedown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&n.button!==0?null:e.onDragStart(n,"rgnode-user",{nodeShape:1,width:150,height:30,borderWidth:0,data:{checkin:!0}},"user")},touchstart:function(n){return e.onDragStart(n,"rgnode-user",{nodeShape:1,width:150,height:30,borderWidth:0,data:{checkin:!0}},"user")}}},[t("NodeSlotUser",{attrs:{icon:!0}})],1)])])},Me=[];const Re={name:"DragableItems",components:{NodeSlotUser:$},data(){return{showNewNodeTemplate:!1,newObjectTemplatePosition:{x:0,y:0},height:275,newNodeIdIndex:1,newLineIdIndex:1}},inject:["graph","currentObject","graphState","graphInstance"],computed:{relationGraph(){return this.graphInstance()},options(){return this.graph.options}},mounted(){this.options.layouts.length>1&&(this.height-=40)},methods:{onDragStart(e,o,t={},n){console.log("on item onDragStart:"),n?(this.graphState.nodeTemplateUseSlot=n,t.data||(t.data={}),t.data.slotId=n):this.graphState.nodeTemplateUseSlot="",this.relationGraph.startCreatingNodePlot(e,{templateText:"Node",templateStyleClass:o,templateNode:t,onCreateNode:(a,r)=>{console.log("新增节点：",a,r);const i=this.relationGraph.generateNewNodeId();this.relationGraph.addNodes([{id:i,text:"新节点"+i,...t,x:a,y:r}])}})}}},C={};var ze=s(Re,Ge,Me,!1,Be,"26acd384",null,null);function Be(e){for(let o in C)this[o]=C[o]}const We=function(){return ze.exports}();var Ae=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{},[t("div",{staticClass:"graph-online",staticStyle:{height:"calc(100vh - 0px)",overflow:"hidden"}},[t("RelationGraph",{ref:"graphRef",attrs:{options:e.graphOptions,"on-canvas-click":e.onCanvasClick,"on-contextmenu":e.onContextmenu,"on-node-click":e.onNodeClick,"on-line-click":e.onLineClick,"on-canvas-selection-end":e.onCanvasSelectionEnd},scopedSlots:e._u([{key:"graph-plug",fn:function(){return[t("ItemOptions"),t("GraphToolBar",{attrs:{"remote-doc-name":e.doc.docName}}),t("DragableItems"),e.isShowNodeTipsPanel?t("div",{staticClass:"c-right-menu-panel",style:{left:e.nodeMenuPanelPosition.x+"px",top:e.nodeMenuPanelPosition.y+"px"}},[t("div",{staticClass:"c-object-info"},[t("div",[e._v("当前右键事件信息：")]),t("div",[e._v("类型："+e._s(e.currentObject.type))]),e.currentObject.type==="link"?t("div",[e._v(e._s(e.currentObject.link.fromNode.text)+" -> "+e._s(e.currentObject.link.toNode.text))]):e._e(),e.currentObject.type==="node"?t("div",[e._v("ID:"+e._s(e.currentObject.node.id))]):e._e(),e.currentObject.type==="node"?t("div",[e._v("Text:"+e._s(e.currentObject.node.text))]):e._e(),t("div",[e._v("你可以对这个对象做以下操作：")])]),e.currentObject.type==="canvas"?t("div",{staticClass:"c-node-menu-item",on:{click:e.addNode}},[e._v("添加节点")]):e._e(),e.currentObject.type==="node"?t("div",{staticClass:"c-node-menu-item",on:{click:e.deleteNode}},[e._v("删除节点")]):e._e(),e.currentObject.type==="node"?t("div",{staticClass:"c-node-menu-item",on:{click:e.createLineFromNode}},[e._v("添加连线")]):e._e(),e.currentObject.type==="link"?t("div",{staticClass:"c-node-menu-item",on:{click:e.deleteLink}},[e._v("删除关系")]):e._e()]):e._e()]},proxy:!0},e.graphState.nodeTemplateUseSlot?{key:"node-template",fn:function(n){var a=n.node;return[e.graphState.nodeTemplateUseSlot==="user"?t("NodeSlotUser",{attrs:{node:a}}):e._e()]}}:null,{key:"node",fn:function(n){var a=n.node;return[a.data&&a.data.slotId==="user"?t("NodeSlotUser",{attrs:{node:a}}):e._e()]}}],null,!0)})],1)])},He=[];const Ee={name:"GraphCreator",components:{NodeSlotUser:$,DragableItems:We,GraphToolBar:W,ItemOptions:$e},data(){return{isShowNodeTipsPanel:!1,nodeMenuPanelPosition:{x:0,y:0},newNodeIdIndex:1,newLineIdIndex:1,localGraph:"",graphOptions:{debug:!0,allowSwitchLineShape:!0,allowSwitchJunctionPoint:!0,allowShowDownloadButton:!0,useAnimationWhenRefresh:!1,moveToCenterWhenRefresh:!1,defaultJunctionPoint:"border",toolBarDirection:"h",toolBarPositionH:"left",toolBarPositionV:"bottom",defaultPloyLineRadius:5,placeSingleNode:!1,placeOtherGroup:!1,layout:{label:"手工",layoutName:"fixed",layoutClassName:"seeks-layout-fixed",defaultJunctionPoint:"border",defaultNodeShape:0,defaultLineShape:1}},graphState:{nodeTemplateUseSlot:"",showDocInfoPanel:!1,showMoreActionPanel:!1,showDefaultNodeOptionsPanel:!1,showDefaultLineOptionsPanel:!1},doc:{docId:"",docName:"",createTime:0,privateDoc:!0,lastUpdateTime:0,history:[]},currentObject:{selectedNodes:[],type:"",node:null,link:null,line:null}}},mounted(){this.doc.docId=this.$route.params.docId,this.localGraph=this.$route.query.localGraph,this.loadGraph()},provide(){return{doc:this.doc,currentObject:this.currentObject,graphState:this.graphState}},methods:{async loadGraph(){if(this.localGraph){const e=localStorage.getItem("local-graph");console.log("open from:local-graph");const o=JSON.parse(e);this.showGraph(o)}else if(this.doc.docId){const o=(await this.SeeksHttp.postJson("/my-graph/get-graph",{docId:this.doc.docId})).data.data,{docContent:t}=o;console.log("graphInfo:",o);const n=JSON.parse(t);console.log("graphJsonData.options:",n.options),this.doc.docId=o.docId,this.doc.docName=o.name,this.doc.createTime=o.createTime,this.doc.privateDoc=o.privateDoc,this.doc.lastUpdateTime=o.lastUpdateTime,this.doc.history=o.history.reverse();const a=this.$refs.graphRef,r=Object.assign({},this.graphOptions);n.options&&Object.keys(n.options).forEach(i=>{i==="layout"||i==="layouts"||(r[i]=n.options[i])}),await a.setOptions(r),this.showGraph(n.jsonData)}else{const e={rootId:"root",nodes:[{id:"root",text:"主题"}],lines:[]};this.showGraph(e)}},async showGraph(e){const o=this.$refs.graphRef.getInstance();await o.setJsonData(e),await o.moveToCenter(),await o.zoomToFit()},onContextmenu(e,o,t){const n=this.$refs.graphRef.getInstance();this.currentObject.type=o,this.currentObject.node=o==="node"?t:null,this.currentObject.link=o==="link"?t:null,this.currentObject.line=o==="line"?t:null;const a=n.getBoundingClientRect();console.log("showNodeMenus:",e,a),this.isShowNodeTipsPanel=!0,this.nodeMenuPanelPosition.x=e.clientX-a.x+10,this.nodeMenuPanelPosition.y=e.clientY-a.y+10;const r=()=>{this.isShowNodeTipsPanel=!1,document.body.removeEventListener("click",r)};document.body.addEventListener("click",r)},addNode(e){const o=this.$refs.graphRef.getInstance(),t=o.getBoundingClientRect(),n=o.getCanvasCoordinateByClientCoordinate({x:this.nodeMenuPanelPosition.x-10+t.x,y:this.nodeMenuPanelPosition.y-10+t.y}),a=o.generateNewNodeId();o.addNodes([{id:a,text:"New-"+a,x:n.x,y:n.y}])},deleteNode(e){this.$refs.graphRef.getInstance().removeNode(this.currentObject.node)},deleteLink(e){this.$refs.graphRef.getInstance().removeLink(this.currentObject.link)},createLineFromNode(e){const o=this.$refs.graphRef.getInstance();o.startCreatingLinePlot(e,{template:{lineWidth:o.options.defaultLineWidth,color:o.options.color,text:"新连线"},fromNode:this.currentObject.node,onCreateLine:(t,n)=>{if(console.log("新增连线：",t,n),n.id){const a=this.newLineIdIndex++;o.addLines([{from:t.id,to:n.id,text:"新连线"+a}])}}})},updateSelectedNodes(){this.currentObject.selectedNodes=[],this.$refs.graphRef.getInstance().getNodes().forEach(o=>{o.selected&&this.currentObject.selectedNodes.push(o)})},onNodeClick(e,o){if(console.log("onNodeClick:",e,o.shiftKey,o.ctrlKey),o.shiftKey)return e.selected=!e.selected,this.updateSelectedNodes(),!1;const t=this.$refs.graphRef.getInstance();t.options.checkedLinkId="",t.options.checkedLineId="",this.currentObject.type="node",this.currentObject.node=e,this.currentObject.link=null,this.currentObject.line=null},onLineClick(e,o,t){const n=this.$refs.graphRef.getInstance();n.options.checkedNodeId="",this.currentObject.type="line",this.currentObject.node=null,this.currentObject.link=o,this.currentObject.line=e,console.log("onLineClick:",e)},onCanvasClick(e){console.log("onCanvasClick:"),this.currentObject.type="canvas",this.currentObject.node=null,this.currentObject.link=null,this.currentObject.line=null,this.$refs.graphRef.getInstance().clearChecked(),this.graphState.showDocInfoPanel&&(this.graphState.showDocInfoPanel=!1),this.graphState.showMoreActionPanel&&(this.graphState.showMoreActionPanel=!1),this.graphState.showDefaultNodeOptionsPanel&&(this.graphState.showDefaultNodeOptionsPanel=!1),this.graphState.showDefaultLineOptionsPanel&&(this.graphState.showDefaultLineOptionsPanel=!1),this.clearSelection()},onCanvasSelectionEnd(e,o){console.log("onCanvasSelectionEnd:",e);const t=this.$refs.graphRef.getInstance(),n=t.getBoundingClientRect(),a=t.getCanvasCoordinateByClientCoordinate({x:e.x+n.x,y:e.y+n.y}),r=t.getCanvasCoordinateByClientCoordinate({x:e.x+e.width+n.x,y:e.y+e.height+n.y});t.getNodes().forEach(i=>{let l=!1;const h=i.x+i.el.offsetWidth/2,f=i.y+i.el.offsetHeight/2;h>a.x&&f>a.y&&h<r.x&&f<r.y&&(l=!0),i.selected=l}),this.updateSelectedNodes()},clearSelection(){this.$refs.graphRef.getInstance().getNodes().forEach(o=>{o.selected=!1}),this.updateSelectedNodes()}}},w={};var Fe=s(Ee,Ae,He,!1,Ye,"096b33bc",null,null);function Ye(e){for(let o in w)this[o]=w[o]}const qe=function(){return Fe.exports}();export{qe as default};
