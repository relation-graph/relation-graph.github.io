import{k as b,C as U}from"./relation-graph-585d193c.js";import{d as O,r as _,o as T,a as u,c as x,b as n,e as P,w as S,u as A,t as B,q as I,p as $,j as M,f as g}from"./index-5a571be1.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";const W=r=>($("data-v-966b94fa"),r=r(),M(),r),z={style:{"background-color":"#f39930"}},J={key:0,style:{color:"#df7f03",padding:"10px"}},G=W(()=>n("div",{style:{"z-index":"300",position:"absolute",left:"10px",top:"calc(100% - 140px)","font-size":"12px","background-color":"#ffffff",border:"#efefef solid 1px","border-radius":"10px",width:"250px",height:"130px"}},[n("div",{style:{"padding-left":"10px"}},[n("div",{style:{"line-height":"30px"}},"The color of the moving over node："),n("div",{style:{"margin-top":"10px"}},[g(" Allowed drop "),n("div",{style:{height:"5px",width:"80px","background-color":"rgba(212,252,189,0.82)"}})]),n("div",{style:{"margin-top":"10px"}},[g(" Not allowed drop "),n("div",{style:{height:"5px",width:"80px","background-color":"rgba(252,189,189,0.82)"}})]),n("div",{style:{"margin-top":"10px"}},[g(" Not allowed to enter "),n("div",{style:{height:"5px",width:"80px","background-color":"rgba(214,165,246,0.82)"}})])])],-1)),H=O({__name:"node-dragging",setup(r){const{RGNodesAnalytic:c}=U,l=_();_(!1);const v={debug:!1,allowSwitchLineShape:!0,allowSwitchJunctionPoint:!0,allowShowDownloadButton:!0,defaultJunctionPoint:"border",placeOtherNodes:!1,placeSingleNode:!1,graphOffset_x:-200,graphOffset_y:100,defaultNodeColor:"#ffffff",defaultNodeBorderWidth:1,defaultNodeBorderColor:"#f39930",defaultNodeWidth:170,defaultNodeHeight:70,defaultLineColor:"#f39930",defaultLineWidth:2,defaultLineTextOffset_y:-2,layout:{layoutName:"fixed"}};T(()=>{y()});const y=async()=>{var e;const o={rootId:"SYS_ROLE",nodes:[{id:"SYS_USER",text:"SYS_USER",nodeShape:1,opacity:1,x:-32,y:-427,width:120,height:80,data:{dropAble:!0}},{id:"SYS_DEPT",text:"SYS_DEPT",nodeShape:0,opacity:1,x:-244,y:-283,data:{dropAble:!0}},{id:"SYS_ROLE",text:"SYS_ROLE",nodeShape:1,opacity:1,x:-21,y:-171,width:300,height:200,data:{allowOverlap:!1}},{id:"SYS_USER_ROLE",text:"SYS_USER_ROLE",nodeShape:1,opacity:1,x:405,y:-174},{id:"SYS_RESOURCE",text:"SYS_RESOURCE",nodeShape:1,opacity:1,x:-246,y:-80,data:{dropAble:!0}},{id:"SYS_ROLE_RESOURCE",text:"SYS_ROLE_RESOURCE",nodeShape:1,opacity:1,x:338,y:-100}],lines:[{from:"SYS_DEPT",to:"SYS_USER",text:"xxxxxxx"},{from:"SYS_DEPT",to:"SYS_USER"},{from:"SYS_DEPT",to:"SYS_USER"},{from:"SYS_DEPT",to:"SYS_USER"},{from:"SYS_DEPT",to:"SYS_USER"},{from:"SYS_DEPT",to:"SYS_USER"}]},a=(e=l.value)==null?void 0:e.getInstance();a&&(await a.setJsonData(o),await a.moveToCenter(),await a.zoomToFit())},E=(o,a,e,i)=>{var f;console.log("onNodeDragging:",o);const t=(f=l.value)==null?void 0:f.getInstance();let s=!1,p;for(const d of(t==null?void 0:t.getNodes())||[]){if(o===d)continue;const D=o.nodeShape||t.options.defaultNodeShape||0,k=d.nodeShape||t.options.defaultNodeShape||0,L={el:o.el,x:a,y:e};if(c.shapesOverlap(L,d,D,k)){let h=d.data.dropAble?"rgba(212,252,189,0.82)":"rgba(252,189,189,0.82)";d.data.allowOverlap===!1&&(s=!0,p=c.getNoOverlapLimitedPosition(o,a,e,d),h="rgba(214,165,246,0.82)"),d.data.orignColorSaved||(d.data.orignColorSaved=!0,d.data.orignColor=d.color),d.color=h}else d.color=void 0}if(s)return p},N=(o,a)=>{console.log("onNodeDragStart:",o),o.data.startX=o.x,o.data.startY=o.y},m=(o,a)=>{var i;console.log("onNodeDragEnd:",o);const e=(i=l.value)==null?void 0:i.getInstance();for(const t of(e==null?void 0:e.getNodes())||[]){if(o===t||t.data.allowOverlap===!1||!t.data.dropAble)continue;const s=o.nodeShape||e.options.defaultNodeShape||0,p=t.nodeShape||e.options.defaultNodeShape||0;if(c.shapesOverlap(o,t,s,p)){R(o,t);break}}for(const t of(e==null?void 0:e.getNodes())||[])t.color=t.data.orignColor},R=(o,a)=>{var i;console.log("updateNodeAsChildren:",a.id,"---->",o.id),o.x=o.data.startX,o.y=o.data.startY;const e=(i=l.value)==null?void 0:i.getInstance();e&&e.addLines([{from:a.id,to:o.id,text:"新连线",color:"rgba(214,165,246,0.82)",lineWidth:3}])},w=(o,a)=>{console.log("onNodeClick:",o)},Y=(o,a,e)=>{console.log("onLineClick:",o)},C=o=>{var a;if(o.target){const e=o.target.tagName;if(e==="path"||e==="text"){const i=(a=l.value)==null?void 0:a.getInstance(),t=i==null?void 0:i.isLink(o.target);t&&console.log("Show Detail:",t.fromNode.id,t.toNode.id,t.text)}else console.log("Hide Detail")}};return(o,a)=>(u(),x("div",null,[n("div",{style:{height:"calc(100vh - 60px)"},onMousemove:C},[P(A(b),{ref_key:"graphRef",ref:l,options:v,"on-node-click":w,"on-line-click":Y,"on-node-dragging":E,"on-node-drag-start":N,"on-node-drag-end":m},{node:S(({node:e})=>[n("div",null,[n("div",z,B(e.text),1),e.id==="SYS_ROLE"?(u(),x("div",J,"Not allowed to enter")):I("",!0)])]),"graph-plug":S(()=>[G]),"canvas-plug":S(()=>[]),_:1},512)],32)]))}});const Q=V(H,[["__scopeId","data-v-966b94fa"]]);export{Q as default};
