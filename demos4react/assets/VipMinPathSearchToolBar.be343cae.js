var P=Object.defineProperty;var w=(n,e,t)=>e in n?P(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>(w(n,typeof e!="symbol"?e+"":e,t),t);import{r as h,j as m,a as d}from"./index.7473cb17.js";import M from"./VipMinPathSearchToolBarButtons.863bd5c7.js";import{MyLinkButton as b,MyCheckBox as y,MyButton as T,ElMessage as u}from"./RGComponentsForDemo.afa6e56e.js";class k{constructor(){f(this,"nodes");f(this,"edges")}loadDataFromRelationGraph(e){this.nodes=e.getNodes().map(t=>({id:t.id,childs:[],indexed:!1,parentNode:null})),this.edges=e.getLinks().map(t=>({from:t.fromNode.id,to:t.toNode.id}))}buildIndexes(e){const t=[];e.forEach(s=>{this.edges.forEach(i=>{if(i.from===s.id){const r=this.getNodeById(i.to);r&&!r.indexed&&(r.indexed=!0,r.parentNode=s,s.childs.push(r),t.push(r))}if(i.to===s.id){const r=this.getNodeById(i.from);r&&!r.indexed&&(r.indexed=!0,r.parentNode=s,s.childs.push(r),t.push(r))}})}),t.length>0&&this.buildIndexes(t)}getNodeById(e){return this.nodes.find(t=>t.id===e)}findMinPath(e,t){const s=this.getNodeById(e);if(!s)throw new Error("\u627E\u4E0D\u5230\u8D77\u70B9!");const i=this.getNodeById(t);if(!i)throw new Error("\u627E\u4E0D\u5230\u7EC8\u70B9!");this.buildIndexes([i]);const r=this.getPath(s,i,[s]);if(r)return r.map(l=>l.id)}getPath(e,t,s){if(e===t)return s.concat(t);if(e.parentNode)return this.getPath(e.parentNode,t,s.concat(e.parentNode))}}const j=({relationGraph:n})=>{const e=n,[t,s]=h.exports.useState(!1),[i,r]=h.exports.useState(""),[l,p]=h.exports.useState(""),[g,E]=h.exports.useState([]),C=()=>{s(!t)},I=()=>{const a=e.getNodes().map(o=>({value:`${o.id}`,text:`${o.text}`}));E(a)},S=()=>{if(!i)return u({type:"error",message:"Please enter the start node!"});if(!l)return u({type:"error",message:"Please enter the end node!"});const a=new k;a.loadDataFromRelationGraph(e);const o=a.findMinPath(i,l);if(!o)return u({type:"error",message:"Cannot find the association between the start node and the end node!"});console.log("nodesInMinPath:",o),v(o),e.dataUpdated()},v=a=>{x(),e.getNodes().forEach(o=>{a.includes(o.id)||(o.opacity=.2)}),e.getLinks().forEach(o=>{o.relations.forEach(c=>{!a.includes(o.fromNode.id)||!a.includes(o.toNode.id)?c.opacity=.2:(c.data.orignColor=c.color,c.color="#ff0000",c.lineWidth=3)})})},x=()=>{e.getNodes().forEach(a=>{a.opacity=1}),e.getLinks().forEach(a=>{a.relations.forEach(o=>{var c;o.opacity=1,o.lineWidth=1,o.color=(c=o.data)==null?void 0:c.orignColor})})},B=()=>{r(""),p(""),x(),e.dataUpdated()},N=(a,o)=>{r(a),p(o)};return h.exports.useEffect(()=>{I()},[]),h.exports.useEffect(()=>{S()},[i,l]),m("div",{style:{width:t?"95px":"500px",height:"400px",paddingTop:"5px",position:"absolute",right:"20px",top:"100px",zIndex:20,padding:"20px",backgroundColor:"#ffffff",border:"#efefef solid 1px",boxShadow:"0 3px 9px rgba(0,21,41,.08)"},children:[d(M,{relationGraph:n}),d("div",{style:{position:"absolute",zIndex:40,left:"0px",top:"0px",width:"20px",height:"100%",backgroundColor:"#f3ba91",color:"#444444",cursor:"pointer",display:"flex",alignItems:"center"},onClick:C,children:d("i",{className:t?"el-icon-caret-left":"el-icon-caret-right"})}),!t&&m("div",{style:{paddingLeft:"20px",paddingRight:"80px"},children:[d("div",{className:"c-form-label",style:{color:"#333333",fontSize:"14px",fontWeight:"bold"},children:"Node Path Search"}),d("div",{children:d(b,{onClick:()=>N("N4","N9"),children:"Try searching: Gao Xiaofeng, Chen Yanshi"})}),d("div",{children:d(b,{onClick:()=>N("N10","N20"),children:"Try searching: Zhao Donglai, Cai Chenggong"})}),d("div",{className:"c-form-label",children:"Start Node:"}),d("div",{className:"h-16 overflow-auto border-gray-500 border rounded-lg",children:d(y,{data:g,currentValue:i,onChange:(a,o)=>{r(a)}})}),d("div",{className:"c-form-label",children:"End Node:"}),d("div",{className:"h-16 overflow-auto border-gray-500 border rounded-lg",children:d(y,{data:g,currentValue:l,onChange:(a,o)=>{p(a)}})}),d("div",{style:{paddingTop:"10px"},children:d(T,{onClick:B,children:"Reset"})})]})]})};export{j as default};
