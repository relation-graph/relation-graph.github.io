import{r as _,a as c,j as x}from"./index.7473cb17.js";import{s as z,u as C,h as F}from"./relation-graph.26f01d58.js";/* empty css                     */const{RGNodesAnalytic:V}=F,Q=()=>{const S=_.exports.useRef(null),y=_.exports.useRef([]);_.exports.useRef("");const $=1;_.exports.useEffect(()=>{I()},[]);const I=async()=>{S.current.getInstance().loading("Wait...");const s=await(await fetch("/demo-data/industry-2.json")).text(),o=JSON.parse(s);console.log("jsonData:",o);const r=o.data.\u4E0A\u6E38[0].children,e=o.data.\u4E2D\u6E38[0].children,a=o.data.\u4E0B\u6E38[0].children,l=L("c1",r,"rgba(215,214,214,1)"),d=j("c2",e,"rgba(246,169,68,0.65)");d.length>0&&l.length>0&&d[0].defaultSetting.refs.push(l[l.length-1].myGroupId);const n=R("c3",a,"rgba(108,200,150,0.53)");d.length>1&&n.length>0&&d[d.length-1].defaultSetting.refs.push(n[n.length-1].myGroupId);const h=[...l,...d,...n];y.current=h,await Y(h)},L=(t,i,s)=>{const o=[];return i.length===1?o.push(b(t,t+"0",i[0],{node:{color:s,width:100,junctionPoint:"lr",expandHolderPosition:"left"},line:{lineShape:4,color:s},layoutSetting:{layoutExpansionDirection:"top",from:"right"},refs:[]})):i.forEach((r,e)=>{o.push(b(t,t+"-"+e,r,{rootIndexOfCol:e,node:{color:s,width:100,junctionPoint:"lr",expandHolderPosition:"left"},line:{lineShape:4,color:s},layoutSetting:{from:"right",layoutExpansionDirection:["bottom","top","top","top","top","top","top"][i.length-1-e],min_per_width:[][e],levelDistance:[][e],alignItems:[][e]},refs:[]}))}),o.forEach((r,e)=>{o.length-e>2&&r.defaultSetting.refs.push(o[e+1].myGroupId)}),o},j=(t,i,s)=>{const o=[];if(i.length===1){const r=i[0];o.push(b(t,t+"0",r,{node:{color:s,width:100,junctionPoint:"lr",expandHolderPosition:"left"},line:{lineShape:4,color:s},layoutSetting:{layoutExpansionDirection:"bottom",from:"right",levelDistance:[20,120,200,200,200,200,200,200,200]},refs:[]}))}else i.forEach((r,e)=>{const a=r;o.push(b(t,t+"-"+e,a,{rootIndexOfCol:e,node:{color:s,width:100,junctionPoint:["lr","tb","tb","tb","tb","tb","tb"][e],expandHolderPosition:["left","bottom","bottom","bottom","bottom","bottom","bottom"][e]},line:{lineShape:4,color:s},layoutSetting:{from:["right","top","top","top","top","top","top"][e],layoutExpansionDirection:["bottom","right","right","right","right","right","right"][e],min_per_width:[200,110,110,110,110,110,110,110][e],min_per_height:[40,100,100,100,100,100,100,100][e],levelDistance:[][e],alignItems:["top","top","top","top","top","top"][e]},refs:[]}))});return o.forEach((r,e)=>{e>0&&e<o.length-1&&r.defaultSetting.refs.push(o[e+1].myGroupId)}),o},R=(t,i,s)=>{const o=[];return i.length===1?o.push(b(t,t+"-0",i[0],{node:{color:s,width:100,junctionPoint:"lr",expandHolderPosition:"right"},line:{lineShape:4,color:s},layoutSetting:{layoutExpansionDirection:"center",from:"left"},refs:[]})):(i.forEach((r,e)=>{o.push(b(t,t+"-"+e,r,{rootIndexOfCol:e,node:{color:s,width:100,junctionPoint:["lr","lr","lr","lr","lr","lr","lr"][i.length-1-e],expandHolderPosition:["right","right","right","right","right","right","right"][i.length-1-e]},line:{lineShape:4,color:s},layoutSetting:{from:["left","left","left","left","left","left","left"][i.length-1-e],layoutExpansionDirection:["bottom","top","top","top","top","top","top"][i.length-1-e],max_per_width:[][e],levelDistance:[][e],alignItems:[][e]},refs:[]}))}),o.forEach((r,e)=>{o.length-e>2&&r.defaultSetting.refs.push(o[e+1].myGroupId)})),o},E=(t,i,s,o,r=0)=>{t.forEach(e=>{const a=e.children,l=a&&a.length>0,d={id:e.id,text:e.text,data:{hasChildren:l,deep:r}};l&&r>$&&(d.expanded=!1),s.push(d),i&&o.push({from:i.id,to:e.id,showEndArrow:!i.id.endsWith("-fake")}),l&&E(a,e,s,o,r+1)})},b=(t,i,s,o)=>{const r=[],e=[],a={id:s.id+"-fake",text:s.text,children:!s.children||s.children.length===0?void 0:[s]},l=a.id,d=s.id;return E([a],null,r,e),console.log(`${t}:${i}`,r.length),r.forEach(n=>{n.data||(n.data={}),n.data.myGroupId=i,n.junctionPoint=o.node.junctionPoint,n.width=o.node.width,n.color=o.node.color,n.data.hasChildren&&(n.expandHolderPosition=o.node.expandHolderPosition),n.id===d||n.id===l?(n.width=10,n.height=10,n.text="",n.disableDrag=!0,n.id===l&&(n.opacity=0),t==="c2"&&n.id===l&&(n.offset_y=-500),t==="c3"&&n.id===l&&(n.width=100,n.alignItems="left"),n.id===l&&(n.expandHolderPosition="hide")):t==="c2"&&(n.alignItems="top"),n.children=void 0}),e.forEach((n,h)=>{n.lineShape=o.line.lineShape,n.color=o.line.color,t==="c1"&&h===0&&(n.polyLineStartDistance=30+o.rootIndexOfCol*15),t==="c2"&&h===0&&(n.fromJunctionPoint="left",n.toJunctionPoint="left",n.polyLineStartDistance=(4-o.rootIndexOfCol)*15),t==="c3"&&h===0&&(n.fromJunctionPoint="right",n.toJunctionPoint="left",n.polyLineStartDistance=30+o.rootIndexOfCol*15)}),{colName:t,groupName:s.text,myGroupId:i,fakeRootNodeId:l,rootNodeId:d,defaultSetting:o,nodes:r,lines:e}},Y=async t=>{const i={rootId:"my-root",nodes:[{id:"my-root",text:"Root Node",opacity:0}],lines:[],elementLines:[]},s=S.current.getInstance();s.loading("Wait...");for(const o of t){const{defaultSetting:r,rootNodeId:e,nodes:a,lines:l}=o;i.nodes.push(...a),i.lines.push(...l),o.nodes=null,o.lines=null}await s.setJsonData(i),await s.sleep(500);for(const o of t)await G(o,0);await s.moveToCenter(),await s.zoomToFit(),s.clearLoading()},B=(t,i)=>{const s=document.getElementById(i);if(s){const o=s.getBoundingClientRect(),r=t.$canvasDom.getBoundingClientRect(),e=(o.x-r.x)/(t.options.canvasZoom/100),a=(o.y-r.y)/(t.options.canvasZoom/100);return{x:e,y:a}}},u=t=>["","    ","        -","            -","                -","                    -","                        -","                            -"][t],G=async(t,i=0,s=-1)=>{console.log(u(i),"Layout Group:",t.myGroupId);const{defaultSetting:o,fakeRootNodeId:r,rootNodeId:e,myGroupId:a}=t,l=S.current.getInstance(),d="root-for-"+a,n=B(l,d),h=l.getNodes().filter(p=>p.data&&p.data.myGroupId===a),f=l.getNodeById(r);f.x=n.x,f.y=n.y+10;const m={layoutName:"tree",from:"right",layoutExpansionDirection:"top",max_per_width:200,max_per_height:40};if(o.layoutSetting.from&&(m.from=o.layoutSetting.from),o.layoutSetting.layoutExpansionDirection&&(m.layoutExpansionDirection=o.layoutSetting.layoutExpansionDirection),o.layoutSetting.min_per_width&&(m.min_per_width=o.layoutSetting.min_per_width,m.max_per_width=o.layoutSetting.min_per_width),o.layoutSetting.min_per_height&&(m.min_per_height=o.layoutSetting.min_per_height,m.max_per_height=o.layoutSetting.min_per_height),h.forEach(p=>{p.data&&p.data.hasChildren&&s!==-1&&(p.data.deep>s?p.expanded=!1:p.expanded=!0)}),f.x=n.x+4,f.y=n.y+10,t.defaultSetting.refs.length>0){const p=t.defaultSetting.refs[0],g=y.current.find(W=>W.myGroupId===p);t.layouted||(console.log(u(i),"Group Ref:",p),await G(g,i+1));const w=N(p);console.log(u(i),`Ref Group[${p}]:Direction:`,g.defaultSetting.layoutSetting.layoutExpansionDirection,w.minY,w.maxY),g.defaultSetting.layoutSetting.layoutExpansionDirection==="top"&&(f.offset_y=n.y-w.minY+45,console.log(u(i),`G  [${a}]root y:`,n.y),console.log(u(i),`Set[${a}]offset_y:`,f.offset_y)),g.defaultSetting.layoutSetting.layoutExpansionDirection==="bottom"&&g.colName==="c1"&&(f.offset_y=n.y-w.maxY-45,console.log(u(i),`G  [${a}]root y:`,n.y),console.log(u(i),`Set[${a}]offset_y:`,f.offset_y)),g.defaultSetting.layoutSetting.layoutExpansionDirection==="right"&&(f.offset_y=n.y-w.maxY+45,console.log(u(i),`G  [${a}]root y:`,n.y),console.log(u(i),`Set[${a}]offset_y:`,f.offset_y)),g.defaultSetting.layoutSetting.layoutExpansionDirection==="bottom"&&g.colName==="c3"&&(f.offset_y=n.y-w.maxY+45,console.log(u(i),`G  [${a}]root y:`,n.y),console.log(u(i),`Set[${a}]offset_y:`,f.offset_y))}const v=z.createLayout(m,l.options,l);v.isMainLayouer=!1,v.layoutOptions.fixedRootNode=!0,console.log(u(i),`Group[${a}]Nodes:`,h.length),await v.placeNodes(h,f),t.layouted=!0;const k=N(a);console.log(u(i),`Group[${a}]:View:`,k.minY,k.maxY)},N=t=>{const o=S.current.getInstance().getNodes().filter(a=>a.data&&a.data.myGroupId===t).filter(a=>V.isAllowShowNode(a));let r=-99999,e=99999;for(const a of o)a.y<e&&(e=a.y),a.y>r&&(r=a.y);return{maxY:r,minY:e}},H=(t,i)=>{console.log("onNodeClick:",t)},J=(t,i,s)=>{console.log("onLineClick:",t)},A=(t,i)=>{console.log("onNodeExpand:"),P(t)},M=(t,i)=>{console.log("onNodeCollapse:"),P(t)},P=async t=>{const i=y.current.find(s=>{var o;return s.myGroupId===((o=t.data)==null?void 0:o.myGroupId)});await G(i),await D(i)},D=async t=>{const i=y.current.filter(s=>s.defaultSetting.refs.includes(t.myGroupId));for(const s of i)await G(s),await D(s)};return c("div",{children:x("div",{style:{height:"calc(100vh)"},children:[c("div",{className:"c-control-panel w-96 rounded-lg absolute left-20 top-20 z-20 p-4 bg-white border-solid border-2 border-black shadow-lg",children:"All content in the example is generated based on dynamic data"}),c(C,{ref:S,options:{debug:!1,layout:{layoutName:"fixed"},defaultPolyLineRadius:10,defaultNodeFontColor:"#333333",allowShowRefreshButton:!1,allowShowDownloadButton:!1,defaultNodeShape:1,defaultLineShape:3,defaultJunctionPoint:"ltrb",defaultNodeBorderWidth:0,defaultLineColor:"rgba(0, 186, 189, 0.7)",defaultNodeColor:"rgba(0, 206, 209, 0.7)"},onNodeClick:H,onLineClick:J,onNodeExpand:A,onNodeCollapse:M,canvasPlugSlot:()=>x("div",{children:[c("div",{style:{position:"absolute",left:"0px",top:"-100px",width:"530px",textAlign:"center"},children:c("h1",{children:"Chip Design Industry Panorama"})}),c("div",{style:{position:"absolute",left:"0px",top:"0px"},children:x("div",{className:"ic-bg",children:[x("div",{className:"ic-col",children:[c("div",{className:"ic-group-header",children:c("div",{className:"ic-group-name",style:{backgroundColor:"#f4f4f4"},children:"Upstream"})}),c("div",{className:"ic-group-body",style:{backgroundColor:"#f4f4f4"},children:y.current.filter(t=>t.colName==="c1").map(t=>c("div",{id:`root-for-${t.myGroupId}`,className:"ic-group-item",style:{backgroundColor:"#457aed"},children:t.groupName},t.myGroupId))})]}),x("div",{className:"ic-col",children:[c("div",{className:"ic-group-header",children:c("div",{className:"ic-group-name",style:{backgroundColor:"#fff7e6"},children:"Midstream"})}),c("div",{className:"ic-group-body",style:{backgroundColor:"#fff7e6"},children:y.current.filter(t=>t.colName==="c2").map(t=>c("div",{id:`root-for-${t.myGroupId}`,className:"ic-group-item",style:{backgroundColor:"#457aed"},children:t.groupName},t.myGroupId))})]}),x("div",{className:"ic-col",children:[c("div",{className:"ic-group-header",children:c("div",{className:"ic-group-name",style:{backgroundColor:"#f6faee"},children:"Downstream"})}),c("div",{className:"ic-group-body",style:{backgroundColor:"#f6faee"},children:y.current.filter(t=>t.colName==="c3").map(t=>c("div",{id:`root-for-${t.myGroupId}`,className:"ic-group-item",style:{backgroundColor:"#457aed"},children:t.groupName},t.myGroupId))})]})]})})]})})]})})};export{Q as default};
